{% extends 'base.html' %}

{% block content %}
<style>
    .priority-high {
        border-left-color: var(--danger);
    }

    .priority-medium {
        border-left-color: var(--warning);
    }

    .priority-low {
        border-left-color: var(--secondary);
    }

    .badge-high {
        background: rgba(239, 68, 68, 0.1);
        color: #f87171;
        border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .badge-medium {
        background: rgba(245, 158, 11, 0.1);
        color: #fbbf24;
        border: 1px solid rgba(245, 158, 11, 0.2);
    }

    .badge-low {
        background: rgba(16, 185, 129, 0.1);
        color: #34d399;
        border: 1px solid rgba(16, 185, 129, 0.2);
    }
</style>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <div>
        <h1><i class="fas fa-tasks" style="margin-right:0.5rem; color:var(--primary)"></i> Tasks</h1>
        <p style="color:var(--text-muted)">Manage and track task progress.</p>
    </div>
    {% if user.role == 'admin' or user.role == 'manager' %}
    <a href="{% url 'task_create' %}" class="btn"><i class="fas fa-plus"></i> New Task</a>
    {% endif %}
</div>

<div class="dashboard-grid">
    {% for task in tasks %}
    <div class="card priority-{{ task.priority }}" style="border-left-width: 5px; border-left-style: solid;">
        <div style="display:flex; justify-content:space-between; margin-bottom: 0.5rem;">
            <span class="badge badge-{{ task.priority }}">
                {{ task.get_priority_display }}
            </span>
            <span class="badge" style="background: rgba(255,255,255,0.05); color: var(--text-muted);">
                {{ task.get_status_display }}
            </span>
        </div>

        <h3>{{ task.title }}</h3>
        <p style="color:var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">
            {{ task.description|truncatewords:20 }}
        </p>

        <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1.5rem;">
            <div style="margin-bottom: 0.25rem;">
                <i class="fas fa-folder" style="width:20px"></i> {{ task.project.name }}
            </div>
            <div style="margin-bottom: 0.25rem;">
                <i class="fas fa-user" style="width:20px"></i> {{ task.assigned_to.username|default:"Unassigned" }}
            </div>
            <div>
                <i class="fas fa-clock" style="width:20px"></i> {{ task.deadline|date:"M d, H:i" }}
            </div>
        </div>

        <div style="display:flex; gap: 0.5rem;">
            <a href="{% url 'task_update' task.pk %}" class="btn"
                style="flex:1; justify-content: center; font-size: 0.9rem; padding: 0.5rem;">
                {% if user.role == 'employee' %}Update{% else %}Edit{% endif %}
            </a>
            {% if user.role == 'admin' or user.role == 'manager' %}
            <a href="{% url 'task_delete' task.pk %}" class="btn btn-danger" style="padding: 0.5rem 0.75rem;">
                <i class="fas fa-trash"></i>
            </a>
            {% endif %}
        </div>
    </div>
    {% empty %}
    <p style="color: var(--text-muted); grid-column: 1/-1; text-align: center; padding: 2rem;">No tasks found.</p>
    {% endfor %}
</div>
{% endblock %}